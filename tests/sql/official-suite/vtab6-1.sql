-- original: vtab6.test
-- credit:   http://www.sqlite.org/src/tree?ci=trunk&name=test

CREATE TABLE real_t1(a,b,c);
  CREATE TABLE real_t2(b,c,d);
  CREATE TABLE real_t3(c,d,e);
  CREATE TABLE real_t4(d,e,f);
  CREATE TABLE real_t5(a INTEGER PRIMARY KEY);
  CREATE TABLE real_t6(a INTEGER);
  CREATE TABLE real_t7 (x, y);
  CREATE TABLE real_t8 (a integer primary key, b);
  CREATE TABLE real_t9(a INTEGER PRIMARY KEY, b);
  CREATE TABLE real_t10(x INTEGER PRIMARY KEY, y);
  CREATE TABLE real_t11(p INTEGER PRIMARY KEY, q);
  CREATE TABLE real_t12(a,b);
  CREATE TABLE real_t13(b,c);
  CREATE TABLE real_t21(a,b,c);
  CREATE TABLE real_t22(p,q)
;CREATE VIRTUAL TABLE sub_t USING echo(real_sub_t)
;INSERT INTO t1 VALUES(1,2,3);
    INSERT INTO t1 VALUES(2,3,4);
    INSERT INTO t1 VALUES(3,4,5);
    SELECT * FROM t1
;INSERT INTO t2 VALUES(1,2,3);
    INSERT INTO t2 VALUES(2,3,4);
    INSERT INTO t2 VALUES(3,4,5);
    SELECT * FROM t2
;SELECT b FROM t1 NATURAL JOIN t2
;SELECT b FROM t1 JOIN t2 USING(b)
;SELECT * FROM t1 NATURAL CROSS JOIN t2
;SELECT * FROM t1 CROSS JOIN t2 USING(b,c)
;SELECT * FROM t1 NATURAL INNER JOIN t2
;SELECT * FROM t1 INNER JOIN t2 USING(b,c)
;SELECT * FROM t1 natural inner join t2
;INSERT INTO t3 VALUES(2,3,4);
    INSERT INTO t3 VALUES(3,4,5);
    INSERT INTO t3 VALUES(4,5,6);
    SELECT * FROM t3
;SELECT * FROM t1 natural join t2 natural join t3
;INSERT INTO t4 VALUES(2,3,4);
    INSERT INTO t4 VALUES(3,4,5);
    INSERT INTO t4 VALUES(4,5,6);
    SELECT * FROM t4
;SELECT * FROM t1 natural join t2 natural join t4
;SELECT * FROM t1 natural join t2 natural join t3 WHERE t1.a=1
;SELECT * FROM t1 NATURAL LEFT JOIN t2
;SELECT * FROM t2 NATURAL LEFT OUTER JOIN t1
;SELECT * FROM t1 LEFT JOIN t2 ON t1.a=t2.d
;SELECT * FROM t1 LEFT JOIN t2 ON t1.a IS t2.d
;SELECT * FROM t1 LEFT JOIN t2 ON t1.a=t2.d WHERE t1.a>1
;SELECT * FROM t1 LEFT JOIN t2 ON t1.a=t2.d WHERE t2.b IS NULL OR t2.b>1
;BEGIN;
    INSERT INTO t6 VALUES(NULL);
    INSERT INTO t6 VALUES(NULL);
    INSERT INTO t6 SELECT * FROM t6;
    INSERT INTO t6 SELECT * FROM t6;
    INSERT INTO t6 SELECT * FROM t6;
    INSERT INTO t6 SELECT * FROM t6;
    INSERT INTO t6 SELECT * FROM t6;
    INSERT INTO t6 SELECT * FROM t6;
    COMMIT
;SELECT * FROM t6 NATURAL JOIN t5
;SELECT * FROM t6, t5 WHERE t6.a<t5.a
;SELECT * FROM t6, t5 WHERE t6.a>t5.a
;UPDATE t6 SET a='xyz';
    SELECT * FROM t6 NATURAL JOIN t5
;SELECT * FROM t6, t5 WHERE t6.a<t5.a
;SELECT * FROM t6, t5 WHERE t6.a>t5.a
;UPDATE t6 SET a=1;
    SELECT * FROM t6 NATURAL JOIN t5
;SELECT * FROM t6, t5 WHERE t6.a<t5.a
;SELECT * FROM t6, t5 WHERE t6.a>t5.a
;INSERT INTO t7 VALUES ("pa1", 1);
    INSERT INTO t7 VALUES ("pa2", NULL);
    INSERT INTO t7 VALUES ("pa3", NULL);
    INSERT INTO t7 VALUES ("pa4", 2);
    INSERT INTO t7 VALUES ("pa30", 131);
    INSERT INTO t7 VALUES ("pa31", 130);
    INSERT INTO t7 VALUES ("pa28", NULL);

    INSERT INTO t8 VALUES (1, "pa1");
    INSERT INTO t8 VALUES (2, "pa4");
    INSERT INTO t8 VALUES (3, NULL);
    INSERT INTO t8 VALUES (4, NULL);
    INSERT INTO t8 VALUES (130, "pa31");
    INSERT INTO t8 VALUES (131, "pa30");

    SELECT coalesce(t8.a,999) from t7 LEFT JOIN t8 on y=a
;BEGIN;
    INSERT INTO t9 VALUES(1,11);
    INSERT INTO t9 VALUES(2,22);
    INSERT INTO t10 VALUES(1,2);
    INSERT INTO t10 VALUES(3,3);    
    INSERT INTO t11 VALUES(2,111);
    INSERT INTO t11 VALUES(3,333);    
    CREATE VIEW v10_11 AS SELECT x, q FROM t10, t11 WHERE t10.y=t11.p;
    COMMIT;
    SELECT * FROM t9 LEFT JOIN v10_11 ON( a=x )
;SELECT * FROM t9 LEFT JOIN (SELECT x, q FROM t10, t11 WHERE t10.y=t11.p)
           ON( a=x)
;SELECT * FROM v10_11 LEFT JOIN t9 ON( a=x )
;BEGIN;
    INSERT INTO t12 VALUES(1,11);
    INSERT INTO t12 VALUES(2,22);
    INSERT INTO t13 VALUES(22,222);
    COMMIT
;SELECT * FROM t12 NATURAL LEFT JOIN t13
      EXCEPT
      SELECT * FROM t12 NATURAL LEFT JOIN (SELECT * FROM t13 WHERE b>0)
;CREATE VIEW v13 AS SELECT * FROM t13 WHERE b>0;
      SELECT * FROM t12 NATURAL LEFT JOIN t13
        EXCEPT
        SELECT * FROM t12 NATURAL LEFT JOIN v13
;CREATE INDEX i22 ON real_t22(q);
    SELECT a FROM t21 LEFT JOIN t22 ON b=p WHERE q=
       (SELECT max(m.q) FROM t22 m JOIN t21 n ON n.b=m.p WHERE n.c=1)
;CREATE TABLE ab_r(a, b);
    CREATE TABLE bc_r(b, c);

    CREATE VIRTUAL TABLE ab USING echo(ab_r); 
    CREATE VIRTUAL TABLE bc USING echo(bc_r); 

    INSERT INTO ab VALUES(1, 2);
    INSERT INTO bc VALUES(2, 3)
;SELECT a, b, c FROM ab NATURAL JOIN bc
;SELECT a, b, c FROM bc NATURAL JOIN ab
;SELECT a, b, c FROM ab NATURAL JOIN bc
;SELECT a, b, c FROM bc NATURAL JOIN ab
;CREATE INDEX ab_i ON ab_r(b);
    CREATE INDEX bc_i ON bc_r(b)
;SELECT a, b, c FROM ab NATURAL JOIN bc
;SELECT a, b, c FROM bc NATURAL JOIN ab
;SELECT a, b, c FROM ab NATURAL JOIN bc
;SELECT a, b, c FROM bc NATURAL JOIN ab
;SELECT a, b, c FROM ab NATURAL JOIN bc
;SELECT a, b, c FROM bc NATURAL JOIN ab
;SELECT a, b, c FROM ab NATURAL JOIN bc
;SELECT a, b, c FROM bc NATURAL JOIN ab;